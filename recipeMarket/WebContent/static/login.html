<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8" />
    <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id" content="152161735609-pa6qec9tnnfbut4jbk88u0lksv7i9eu3.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <title>Recipe Market</title>
    <link rel="stylesheet" href="/recipeMarket/css/header.css">
    <link rel="stylesheet" href="/recipeMarket/css/divContent.css">
    <link rel="stylesheet" href="/recipeMarket/css/footer.css">
    <link rel="stylesheet" href="/recipeMarket/css/login.css">
	<link rel="stylesheet" href="/recipeMarket/css/modal.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="/recipeMarket/js/dropdownMenu.js"></script>
    <script src="/recipeMarket/js/header.js"></script>
    <script src="/recipeMarket/js/login.js"></script>
    <script src="/recipeMarket/js/footer.js"></script>
    <script>
    	function snsLogin(email) {
    		$.ajax({
				url : "/recipeMarket/sns",
			    data : {snsEmail : email},
			    success : (data, textStatus, jqXHR) => {
			    	if(data.status == "success") {
			        	location.href = "/recipeMarket";
			        } else {
			            location.href = "/recipeMarket/register";
			        }
			    }
			});
    	}
    
		function onSignIn(googleUser) {
			// Useful data for your client-side scripts:
			var profile = googleUser.getBasicProfile();
// 			console.log("ID: " + profile.getId()); // Don't send this directly to your server!
// 			console.log('Full Name: ' + profile.getName());
// 			console.log('Given Name: ' + profile.getGivenName());
// 			console.log('Family Name: ' + profile.getFamilyName());
// 			console.log("Image URL: " + profile.getImageUrl());
// 			console.log("Email: " + profile.getEmail());
			
			// The ID token you need to pass to your backend:
			var id_token = googleUser.getAuthResponse().id_token;
// 			console.log("ID Token: " + id_token);
			
			snsLogin(profile.getEmail());
		};
		
		function statusChangeCallback(response) {  // Called with the results from FB.getLoginStatus().
// 			console.log('statusChangeCallback');
// 			console.log(response);                   // The current login status of the person.
			if (response.status === 'connected') {   // Logged into your webpage and Facebook.
				testAPI();  
			} else {                                 // Not logged into your webpage or we are unable to tell.
				document.getElementById('status').innerHTML = 'Please log into this webpage.';
			}
		}


		function checkLoginState() {               // Called when a person is finished with the Login Button.
			FB.getLoginStatus(function(response) {   // See the onlogin handler
				statusChangeCallback(response);
			});
		}
		
		window.fbAsyncInit = function() {
			FB.init({
				appId      : '617541042250809',
				cookie     : true,                     // Enable cookies to allow the server to access the session.
				xfbml      : true,                     // Parse social plugins on this webpage.
				version    : 'v8.0'           // Use this Graph API version for this call.
			});


			FB.getLoginStatus(function(response) {   // Called after the JS SDK has been initialized.
				statusChangeCallback(response);        // Returns the login status.
			});
		};
			 
		function testAPI() {                      // Testing Graph API after login.  See statusChangeCallback() for when this call is made.
// 			console.log('Welcome!  Fetching your information.... ');
			FB.api('/me', {fields : "email"}, function(response) {
// 				console.log(response)
// 				console.log('Successful login for: ' + response.name);
// 				document.getElementById('status').innerHTML =
// 					'Thanks for logging in, ' + response.name + '!';
				snsLogin(response.email);
			});
		}
		
	</script>
</head>

<body>
	<div id="fb-root"></div>
	<script async defer crossorigin="anonymous" src="https://connect.facebook.net/ko_KR/sdk.js#xfbml=1&version=v8.0&appId=617541042250809&autoLogAppEvents=1" nonce="2q0HRbeq"></script>
    <header>
        <!-- 왼쪽 영역 -->
        <div class="headerLeftSection">
            <!-- 로고(홈 버튼) -->
            <h1 class="home">RECIPE MARKET</h1>
        </div>
        <!-- 오른쪽 영역 -->
        <div class="headerRightSection">
            <!-- 드롭다운 메뉴 -->
            <div class="dropdown">
                <!-- 로그인 버튼(누르면 드롭다운 메뉴 보이도록) -->
                <h1 class="account">로그인</h1>
                <!-- 드롭다운 메뉴 구성 (동적 생성 필요) -->
                <div class="dropdown-content">
                    <a href="">로그인</a>
                </div>
            </div>
        </div>
    </header>
    <div class="divContent">
        <!-- 오른쪽 영역 (화면에 따라 동적 생성 필요) -->
        <section class="rightSection">
            <form action="/recipeMarket/login/customer" method="POST">
                <label><input type="text" name="id" placeholder="Email..."></label>
                <label><input type="password" name="pwd" placeholder="Password..."></label>
                <button type="submit">로그인</button>
                <label><a href="#">회원가입</a> <a onclick="openModal();">비밀번호 찾기</a></label>
                <div class="g-signin2" data-onsuccess="onSignIn" data-theme="dark">구글 로그인</div>
                <fb:login-button scope="public_profile,email" onlogin="checkLoginState();">
				</fb:login-button>
            </form>
        </section>
    </div>
    
    <footer>
        <p>
            © 2020 RECIPE MARKET All rights reserved.
        </p>
        <!-- <a class="topBtn">&uarr;TOP</a> -->
    </footer>
</body>
<div class="modal fade" id="pwdModal" role="dialog">
			<div class="modal-dialog">
				<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">비밀번호 찾기</h4>
					</div>
					<div class="modal-body">
						<div class="reviewContent">
							<input id="content" type="text" value="" size="50"
								placeholder="이메일을 입력해주세요"><br>							
						</div>
						<button type="button" class="reviewBtn" data-dismiss="modal">인증번호 받기</button>
					</div>
				</div>
			</div>
		</div>


</html>